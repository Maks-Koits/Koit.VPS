# Инструкция по использованию аналитики

## Быстрый старт

1. **Запуск сервиса:**
   ```bash
   docker-compose up -d analytics
   ```

2. **Проверка работы:**
   - Откройте сайт: https://maks-koits.cv
   - JavaScript трекер автоматически отправит данные о посещении
   - Откройте статистику: https://analytics.maks-koits.cv/stats

## Что собирается

### Автоматически через JavaScript трекер:
- IP адрес посетителя
- Страна и город (определяется по IP)
- Посещаемая страница
- Referer (откуда пришел)
- User Agent (браузер, ОС)
- Разрешение экрана
- Язык браузера
- Часовой пояс

### Статистика, которую можно посмотреть:

1. **Общая статистика:**
   - Всего посещений
   - Уникальных посетителей (по IP)
   - Посещений сегодня
   - Количество стран

2. **Посещения по странам:**
   - Список стран с количеством посещений
   - Уникальных IP адресов из каждой страны
   - Последнее посещение из страны

3. **Популярные страницы:**
   - Какие страницы посещаются чаще всего
   - Уникальные посетители по страницам

4. **Последние посещения:**
   - Детальная информация о каждом посещении
   - Время, IP, страна, страница, браузер

## API для получения данных

### JSON API:
```bash
# Статистика за последние 30 дней
curl https://analytics.maks-koits.cv/api/stats?days=30

# Статистика за последние 7 дней
curl https://analytics.maks-koits.cv/api/stats?days=7
```

Ответ:
```json
{
  "daily": [
    {
      "date": "2026-02-10",
      "visits": 15,
      "unique_visitors": 8
    }
  ],
  "countries": [
    {
      "country": "Belarus",
      "visits": 10,
      "unique_ips": 5
    }
  ]
}
```

## Дополнительная статистика, которую можно добавить

1. **Время на сайте** - отслеживание времени между загрузкой страницы и уходом
2. **Глубина просмотра** - сколько страниц просмотрел посетитель за сессию
3. **Источники трафика** - откуда приходят посетители (поисковики, соцсети, прямые заходы)
4. **Устройства** - мобильные/десктоп (определяется по User Agent)
5. **Браузеры** - какие браузеры используют посетители
6. **Часы активности** - в какое время дня больше всего посещений
7. **Дни недели** - какие дни наиболее активные
8. **Повторные посетители** - кто возвращается на сайт

## Рекомендации

1. **Для определения страны:**
   - Текущее решение использует бесплатный ip-api.com (45 запросов/минуту)
   - Для production рекомендуется использовать GeoIP2 MaxMind (платный, но точнее)
   - Или можно использовать кэширование IP -> страна в БД

2. **Для больших объемов:**
   - SQLite подходит до ~100K посещений/месяц
   - Для большего объема рекомендуется PostgreSQL
   - Можно добавить ротацию старых данных (архивирование)

3. **Безопасность:**
   - Рекомендуется добавить аутентификацию для `/stats`
   - Можно добавить rate limiting для `/track`
   - Можно добавить фильтрацию ботов по User Agent

4. **Производительность:**
   - Текущее решение очень легковесное (~50-100MB RAM)
   - SQLite индексирован для быстрых запросов
   - Можно добавить кэширование популярных запросов

## Мониторинг

Проверка здоровья сервиса:
```bash
curl https://analytics.maks-koits.cv/health
```

Просмотр логов:
```bash
docker logs maks-koits-cv-analytics
```

## Резервное копирование

База данных хранится в `/app/analytics_data/analytics.db`

Для резервного копирования:
```bash
# На сервере
cp /app/analytics_data/analytics.db /backup/analytics_$(date +%Y%m%d).db
```

## Альтернативные решения

Если текущее решение не подходит, можно рассмотреть:

1. **GoAccess** - анализ логов nginx в реальном времени (очень легковесный)
2. **Plausible Analytics** - privacy-friendly аналитика (легковесная)
3. **Matomo** - полнофункциональная аналитика (более тяжелая, но мощная)
4. **Google Analytics** - облачное решение (но требует согласия на cookies в EU)
