# Analytics Service для maks-koits.cv

Легковесный сервис аналитики для отслеживания посещений сайта.

## Возможности

- ✅ Сбор IP адресов посетителей
- ✅ Определение страны и города по IP (через ip-api.com)
- ✅ Статистика по страницам
- ✅ Уникальные посетители
- ✅ Веб-интерфейс для просмотра статистики
- ✅ JSON API для интеграции
- ✅ Легковесный (SQLite, минимальные зависимости)
- ✅ Поддержка CORS для JavaScript трекера

## Использование

### Веб-интерфейс
Откройте `https://analytics.maks-koits.cv/stats` для просмотра статистики.

### API Endpoints

- `POST /track` - Отправка данных о посещении (используется JavaScript трекером)
- `GET /stats` - Веб-интерфейс со статистикой
- `GET /api/stats?days=30` - JSON API со статистикой за последние N дней
- `GET /health` - Health check

### Собираемая статистика

1. **Общая статистика:**
   - Всего посещений
   - Уникальных посетителей
   - Посещений сегодня
   - Количество стран

2. **По странам:**
   - Количество посещений
   - Уникальных IP адресов
   - Последнее посещение

3. **По страницам:**
   - Популярные страницы
   - Количество посещений каждой страницы
   - Уникальные посетители по страницам

4. **Детали посещений:**
   - Время посещения
   - IP адрес
   - Страна и город
   - Страница
   - User Agent
   - Разрешение экрана
   - Язык браузера
   - Часовой пояс

## Установка

Сервис автоматически запускается через docker-compose:

```bash
docker-compose up -d analytics
```

## Конфигурация

Переменные окружения:
- `DATABASE_PATH` - путь к файлу SQLite (по умолчанию: `/data/analytics.db`)
- `PORT` - порт для Flask приложения (по умолчанию: `5000`)
- `LOG_LEVEL` - уровень логирования (по умолчанию: `INFO`)

## Производительность

- Использует SQLite для хранения данных
- Минимальное потребление памяти (~50-100MB)
- Быстрые запросы благодаря индексам
- Подходит для небольших и средних сайтов (до 100K посещений/месяц)

## Ограничения

- ip-api.com имеет лимит 45 запросов/минуту (для production лучше использовать GeoIP2)
- SQLite подходит для небольших и средних нагрузок
- Для больших объемов данных рекомендуется PostgreSQL

## Безопасность

- Трекер работает только на вашем домене
- CORS настроен для вашего домена
- IP адреса хранятся в зашифрованном виде (можно добавить)
- Рекомендуется добавить аутентификацию для `/stats` endpoint

## Альтернативные решения

1. **GoAccess** - очень легковесный анализатор логов nginx
2. **Plausible Analytics** - privacy-friendly аналитика
3. **Matomo** - полнофункциональная аналитика (более тяжелая)
