---
version: "3.9"

services:
  nginx-proxy:
    image: nginxproxy/nginx-proxy:alpine
    container_name: 'nginx-proxy'
    volumes:
      - /app/config/html:/usr/share/nginx/html
      - /app/config/dhparam:/etc/nginx/dhparam
      - /app/config/vhost:/etc/nginx/vhost.d
      - /app/config/certs:/etc/nginx/certs
      - /app/config/conf:/etc/nginx/conf.d
      - /var/run/docker.sock:/tmp/docker.sock:ro
      - /etc/localtime:/etc/localtime:ro
    restart: always
    networks:
      - net
    ports:
      - 80:80
      - 443:443
#      - 9000:9000
#      - 9443:9443

  acme:
    image: nginxproxy/acme-companion:latest
    container_name: 'nginx-proxy-acme-companion'
    depends_on:
      - nginx-proxy
    volumes_from:
      - nginx-proxy
    volumes:
      - /app/config/acme:/etc/acme.sh
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      NGINX_PROXY_CONTAINER: 'nginx-proxy'
      DEFAULT_EMAIL: 'mix256@gmail.com'
    restart: always
    networks:
      - net

  maks-koits-github-io:
    image: nginx:stable-alpine
    container_name: 'maks-koits-click'
    depends_on:
      - nginx-proxy
    volumes:
      - /app/Maks-Koits.github.io:/usr/share/nginx/html
      - /etc/localtime:/etc/localtime:ro
    environment:
#      TZ: 'Europe/Minsk'
      VIRTUAL_HOST: 'maks-koits.click'
      LETSENCRYPT_HOST: 'maks-koits.click'
    restart: unless-stopped
    networks:
      - net

  portainer:
    image: portainer/portainer-ce:linux-amd64
    container_name: 'portainer-maks-koits-click'
    depends_on:
      - nginx-proxy
    volumes:
      - /app/portainer_data:/data
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /etc/localtime:/etc/localtime:ro
#        - /app/config/certs:/certs:ro
#    command: --ssl --sslcert /certs/server-cert.pem --sslkey /certs/server-key.pem --tlsverify --tlscacert /docker-certs/ca.pem --tlscert /docker-certs/server-cert.pem --tlskey /docker-certs/server-key.pem
#    command:
#        - --ssl
#        - --sslcert /certs/portainer.maks-koits.click/cert.pem
#        - --sslkey /certs/portainer.maks-koits.click/key.pem
    environment:
      VIRTUAL_HOST: 'portainer.maks-koits.click'
      VIRTUAL_PORT: '9000'
      LETSENCRYPT_HOST: 'portainer.maks-koits.click'
      LETSENCRYPT_EMAIL: 'mix256@gmail.com'
    restart: unless-stopped
    networks:
      - net

  node_exporter:
    image: prometheus/node-exporter:latest
    container_name: 'node-exporter-maks-koits-click'
    depends_on:
      - nginx-proxy
    volumes:
      - /:/host:ro,rslave
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /etc/localtime:/etc/localtime:ro
    command:
      - --path.rootfs=/host
    environment:
      VIRTUAL_HOST: 'node-exporter.maks-koits.click'
      VIRTUAL_PORT: '9100'
      LETSENCRYPT_HOST: 'node-exporter.maks-koits.click'
      LETSENCRYPT_EMAIL: 'mix256@gmail.com'
    restart: unless-stopped
    networks:
      - net

networks:
  net:
    driver: bridge